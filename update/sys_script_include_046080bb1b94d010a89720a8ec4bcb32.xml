<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_snc_datasilos.PrepareQuery</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>The PrepareQuery function is the heart of the DataSilos application. It takes a GlideRecord object and adds all filter criteria that apply to the current user when trying to access records in the given table. It is used by all entry point functions. However, it does not check for the roles of the current user - which means it can also be used to check if a record would be visible to a user even if the user has the sentinel or admin role.</description>
        <name>PrepareQuery</name>
        <script><![CDATA[function PrepareQuery(record, strTable, strPrefix, strUserSysId, bAllowEmptySysId)
{
	var GetValue = x_snc_devtools.GetValue;
	var GetBoolValue = x_snc_devtools.GetBoolValue;
	var GetStringValue = x_snc_devtools.GetStringValue;
	var GetArrayValue = x_snc_devtools.GetArrayValue;
	var IsValidSysId = x_snc_devtools.IsValidSysId;
	
	strPrefix = GetStringValue(strPrefix);
	strTable = GetStringValue(strTable);
	strUserSysId = GetStringValue(strUserSysId);
	bAllowEmptySysId = GetBoolValue(bAllowEmptySysId);
	if (IsValidSysId(strUserSysId) == false)
	{
		strUserSysId = gs.getUser().getID();	
	}
	
	if (strTable == '')
	{
		strTable = record.getRecordClassName();
	}
	if (strPrefix != '')
	{
		strPrefix += '_';
	}

	var nUserSecurityClearance = 0;
	if (GetBoolValue(GetValue(GetConfig(),'security_clearance','active')))
	{
		nUserSecurityClearance = GetSecurityClearanceFromUser(strUserSysId);
	}
	
	var aUserSupervisorSilos = GetSilosFromUserByTypes(strUserSysId,['supervisor']);
	var aUserGroups = GetGroupsFromUser(strUserSysId);
	
	return PrepareQueryInternal(
		record,
		strTable,
		strPrefix,
		strUserSysId,
		bAllowEmptySysId,
		aUserSupervisorSilos,
		aUserGroups,
		nUserSecurityClearance);
}]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-04-27 09:04:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>046080bb1b94d010a89720a8ec4bcb32</sys_id>
        <sys_mod_count>53</sys_mod_count>
        <sys_name>PrepareQuery</sys_name>
        <sys_package display_value="DataSilos" source="x_snc_datasilos">dafbffebdbb78450ba15a353059619eb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="DataSilos">dafbffebdbb78450ba15a353059619eb</sys_scope>
        <sys_update_name>sys_script_include_046080bb1b94d010a89720a8ec4bcb32</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-06-23 17:07:26</sys_updated_on>
    </sys_script_include>
</record_update>
